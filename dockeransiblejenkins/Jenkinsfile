pipeline{
    agent any
    tools {
        maven 'maven-3'
    }
    
    stages{
        stage('SCM'){
            git credentialsId: 'GitHub_Access', 
                url: 'https://github.com/mmadsen340/udemy_jenkins_ansible.git'
            }
    
        stage('Maven Build'){
            def mvnHome = tool name: 'maven-3', type: 'maven'
            sh "${mvnHome}/bin/mvn -f dockeransiblejenkins/pom.xml clean package"
            }

        stage('SonarQube Analysis') {
            def mvnHome = tool name: 'maven-3', type: 'maven'
        withSonarQubeEnv('mikes_lab_sonarqube') {
            sh "${mvnHome}/bin/mvn -f dockeransiblejenkins/pom.xml sonar:sonar"
            }
        }

    }
}    
